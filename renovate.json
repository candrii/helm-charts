{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": ["config:recommended"],
  "dependencyDashboard": true,
  "allowedPostUpgradeCommands": ["^./scripts/bump-chart-version\\.sh"],
  "packageRules": [
    {
      "description": "Auto-create PRs for custom manager deps and bump chart version",
      "matchManagers": ["custom.regex"],
      "dependencyDashboardApproval": false,
      "postUpgradeTasks": {
        "commands": ["./scripts/bump-chart-version.sh {{{packageFileDir}}}/values.yaml"],
        "fileFilters": ["charts/**/Chart.yaml"],
        "executionMode": "branch"
      }
    },
    {
      "description": "Group all victoriametrics chart updates",
      "matchPackagePatterns": ["victoriametrics", "victoria-metrics"],
      "groupName": "victoriametrics charts"
    }
  ],
  "customManagers": [
    {
      "customType": "regex",
      "description": "Track OCI Helm charts from candrii",
      "fileMatch": ["charts/.*/values\\.yaml$"],
      "matchStrings": [
        "repoURL:\\s*oci://ghcr\\.io/(?<depName>candrii/charts/[a-z0-9-]+)\\n\\s+version:\\s*[\"']?(?<currentValue>[^\"'\\s]+)[\"']?"
      ],
      "datasourceTemplate": "docker",
      "registryUrlTemplate": "https://ghcr.io"
    },
    {
      "customType": "regex",
      "description": "Track VictoriaMetrics operator OCI chart",
      "fileMatch": ["charts/.*/values\\.yaml$"],
      "matchStrings": [
        "repoURL:\\s*oci://ghcr\\.io/(?<depName>victoriametrics/helm-charts/[a-z0-9-]+)\\n\\s+version:\\s*[\"']?(?<currentValue>[^\"'\\s]+)[\"']?"
      ],
      "datasourceTemplate": "docker",
      "registryUrlTemplate": "https://ghcr.io"
    }
  ]
}
